<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>SafetyTwin Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
        body { padding: 2rem; }
        .log-box { background: #222; color: #eee; padding: 1rem; border-radius: 6px; font-family: monospace; max-height: 300px; overflow-y: auto; }
        .diff-added { background: #d4f8e8; }
        .diff-removed { background: #ffeaea; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">SafetyTwin Dashboard</h1>
        <div class="row mb-4">
            <div class="col-md-6">
                <h4>Aktualny stan systemu</h4>
                <pre>{{ current_state | tojson(indent=2) }}</pre>
            </div>
            <div class="col-md-6">
                <h4>Usługi</h4>
                <ul>
                    {% for svc in current_state.services %}
                        <li>{{ svc }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="mb-4">
            <h4>Historia zmian</h4>
            <ul>
                {% for item in history %}
                    <li>[{{ item.timestamp }}] Stan: {{ item.id }} {% if item.current %}<b>(aktualny)</b>{% endif %}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="mb-4">
            <h4>Logi orchestratora</h4>
            <div class="log-box">{{ orchestrator_logs }}</div>
        </div>
        <div class="mb-4">
            <h4>Logi agenta</h4>
            <div class="log-box">{{ agent_logs }}</div>
        </div>
        <div class="mb-4">
            <h4>Snapshoty VM</h4>
            <ul>
                {% for snap in snapshots %}
                    <li>{{ snap.name }} ({{ snap.created }})
                        <form method="post" action="/snapshots/revert/{{ snap.name }}" style="display:inline;">
                            <button class="btn btn-sm btn-warning">Przywróć</button>
                        </form>
                        <form method="post" action="/snapshots/delete/{{ snap.name }}" style="display:inline;">
                            <button class="btn btn-sm btn-danger">Usuń</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
            <form method="post" action="/snapshots/create">
                <button class="btn btn-success">Utwórz snapshot</button>
            </form>
        </div>
        <div class="mb-4">
            <h4>Synchronizacja usług</h4>
            <form method="post" action="/sync">
                <button class="btn btn-primary">Wymuś synchronizację</button>
            </form>
        </div>
        <div class="mb-4">
            <h4>Rollback do snapshotu</h4>
            <form method="post" action="/rollback">
                <select name="snapshot_name" class="form-select" style="width:auto;display:inline-block;">
                    {% for snap in snapshots %}
                        <option value="{{ snap.name }}">{{ snap.name }} ({{ snap.created }})</option>
                    {% endfor %}
                </select>
                <button class="btn btn-secondary">Rollback</button>
            </form>
        </div>
    </div>
</body>
</html>
